# Comparing `tmp/odoo_addon_account_invoice_change_currency-15.0.2.0.0.4-py3-none-any.whl.zip` & `tmp/odoo_addon_account_invoice_change_currency-16.0.1.0.1-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,29 +1,29 @@
-Zip file size: 37331 bytes, number of entries: 27
--rw-r--r--  2.0 unx     4381 b- defN 22-Aug-10 02:42 odoo/addons/account_invoice_change_currency/README.rst
--rw-r--r--  2.0 unx      177 b- defN 22-Aug-10 02:42 odoo/addons/account_invoice_change_currency/__init__.py
--rw-r--r--  2.0 unx      675 b- defN 22-Aug-10 02:42 odoo/addons/account_invoice_change_currency/__manifest__.py
--rw-r--r--  2.0 unx      656 b- defN 22-Aug-10 02:42 odoo/addons/account_invoice_change_currency/hooks.py
--rw-r--r--  2.0 unx     4766 b- defN 22-Aug-10 02:42 odoo/addons/account_invoice_change_currency/i18n/account_invoice_change_currency.pot
--rw-r--r--  2.0 unx     5465 b- defN 22-Aug-10 02:42 odoo/addons/account_invoice_change_currency/i18n/ca.po
--rw-r--r--  2.0 unx     5547 b- defN 22-Aug-10 02:42 odoo/addons/account_invoice_change_currency/i18n/de.po
--rw-r--r--  2.0 unx     5733 b- defN 22-Aug-10 02:42 odoo/addons/account_invoice_change_currency/i18n/es.po
--rw-r--r--  2.0 unx     4842 b- defN 22-Aug-10 02:42 odoo/addons/account_invoice_change_currency/i18n/es_MX.po
--rw-r--r--  2.0 unx     5310 b- defN 22-Aug-10 02:42 odoo/addons/account_invoice_change_currency/i18n/hr.po
--rw-r--r--  2.0 unx       86 b- defN 22-Aug-10 02:42 odoo/addons/account_invoice_change_currency/models/__init__.py
--rw-r--r--  2.0 unx     3929 b- defN 22-Aug-10 02:42 odoo/addons/account_invoice_change_currency/models/account_move.py
--rw-r--r--  2.0 unx      805 b- defN 22-Aug-10 02:42 odoo/addons/account_invoice_change_currency/models/account_move_line.py
--rw-r--r--  2.0 unx      701 b- defN 22-Aug-10 02:42 odoo/addons/account_invoice_change_currency/models/res_currency.py
--rw-r--r--  2.0 unx       99 b- defN 22-Aug-10 02:42 odoo/addons/account_invoice_change_currency/readme/CONFIGURE.rst
--rw-r--r--  2.0 unx      181 b- defN 22-Aug-10 02:42 odoo/addons/account_invoice_change_currency/readme/CONTRIBUTORS.rst
--rw-r--r--  2.0 unx      742 b- defN 22-Aug-10 02:42 odoo/addons/account_invoice_change_currency/readme/DESCRIPTION.rst
--rw-r--r--  2.0 unx      179 b- defN 22-Aug-10 02:42 odoo/addons/account_invoice_change_currency/readme/USAGE.rst
--rw-r--r--  2.0 unx     9455 b- defN 22-Aug-10 02:42 odoo/addons/account_invoice_change_currency/static/description/icon.png
--rw-r--r--  2.0 unx    14190 b- defN 22-Aug-10 02:42 odoo/addons/account_invoice_change_currency/static/description/index.html
--rw-r--r--  2.0 unx      174 b- defN 22-Aug-10 02:42 odoo/addons/account_invoice_change_currency/tests/__init__.py
--rw-r--r--  2.0 unx    12032 b- defN 22-Aug-10 02:42 odoo/addons/account_invoice_change_currency/tests/test_account_invoice_change_currency.py
--rw-r--r--  2.0 unx     2158 b- defN 22-Aug-10 02:42 odoo/addons/account_invoice_change_currency/views/account_move_views.xml
--rw-r--r--  2.0 unx     4976 b- defN 22-Aug-10 02:43 odoo_addon_account_invoice_change_currency-15.0.2.0.0.4.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 22-Aug-10 02:43 odoo_addon_account_invoice_change_currency-15.0.2.0.0.4.dist-info/WHEEL
--rw-r--r--  2.0 unx        5 b- defN 22-Aug-10 02:43 odoo_addon_account_invoice_change_currency-15.0.2.0.0.4.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx     3230 b- defN 22-Aug-10 02:43 odoo_addon_account_invoice_change_currency-15.0.2.0.0.4.dist-info/RECORD
-27 files, 90586 bytes uncompressed, 31735 bytes compressed:  65.0%
+Zip file size: 36764 bytes, number of entries: 27
+-rw-r--r--  2.0 unx     4464 b- defN 23-May-26 16:19 odoo/addons/account_invoice_change_currency/README.rst
+-rw-r--r--  2.0 unx      177 b- defN 23-May-26 16:19 odoo/addons/account_invoice_change_currency/__init__.py
+-rw-r--r--  2.0 unx      675 b- defN 23-May-26 16:19 odoo/addons/account_invoice_change_currency/__manifest__.py
+-rw-r--r--  2.0 unx      656 b- defN 23-May-26 16:19 odoo/addons/account_invoice_change_currency/hooks.py
+-rw-r--r--  2.0 unx     4766 b- defN 23-May-26 16:19 odoo/addons/account_invoice_change_currency/i18n/account_invoice_change_currency.pot
+-rw-r--r--  2.0 unx     5465 b- defN 23-May-26 16:19 odoo/addons/account_invoice_change_currency/i18n/ca.po
+-rw-r--r--  2.0 unx     5547 b- defN 23-May-26 16:19 odoo/addons/account_invoice_change_currency/i18n/de.po
+-rw-r--r--  2.0 unx     5733 b- defN 23-May-26 16:19 odoo/addons/account_invoice_change_currency/i18n/es.po
+-rw-r--r--  2.0 unx     4842 b- defN 23-May-26 16:19 odoo/addons/account_invoice_change_currency/i18n/es_MX.po
+-rw-r--r--  2.0 unx     5310 b- defN 23-May-26 16:19 odoo/addons/account_invoice_change_currency/i18n/hr.po
+-rw-r--r--  2.0 unx       86 b- defN 23-May-26 16:19 odoo/addons/account_invoice_change_currency/models/__init__.py
+-rw-r--r--  2.0 unx     3984 b- defN 23-May-26 16:19 odoo/addons/account_invoice_change_currency/models/account_move.py
+-rw-r--r--  2.0 unx      832 b- defN 23-May-26 16:19 odoo/addons/account_invoice_change_currency/models/account_move_line.py
+-rw-r--r--  2.0 unx      701 b- defN 23-May-26 16:19 odoo/addons/account_invoice_change_currency/models/res_currency.py
+-rw-r--r--  2.0 unx       99 b- defN 23-May-26 16:19 odoo/addons/account_invoice_change_currency/readme/CONFIGURE.rst
+-rw-r--r--  2.0 unx      264 b- defN 23-May-26 16:19 odoo/addons/account_invoice_change_currency/readme/CONTRIBUTORS.rst
+-rw-r--r--  2.0 unx      742 b- defN 23-May-26 16:19 odoo/addons/account_invoice_change_currency/readme/DESCRIPTION.rst
+-rw-r--r--  2.0 unx      179 b- defN 23-May-26 16:19 odoo/addons/account_invoice_change_currency/readme/USAGE.rst
+-rw-r--r--  2.0 unx     9455 b- defN 23-May-26 16:19 odoo/addons/account_invoice_change_currency/static/description/icon.png
+-rw-r--r--  2.0 unx    14440 b- defN 23-May-26 16:19 odoo/addons/account_invoice_change_currency/static/description/index.html
+-rw-r--r--  2.0 unx      174 b- defN 23-May-26 16:19 odoo/addons/account_invoice_change_currency/tests/__init__.py
+-rw-r--r--  2.0 unx     8605 b- defN 23-May-26 16:19 odoo/addons/account_invoice_change_currency/tests/test_account_invoice_change_currency.py
+-rw-r--r--  2.0 unx     2158 b- defN 23-May-26 16:19 odoo/addons/account_invoice_change_currency/views/account_move_views.xml
+-rw-r--r--  2.0 unx     5058 b- defN 23-May-26 16:19 odoo_addon_account_invoice_change_currency-16.0.1.0.1.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-May-26 16:19 odoo_addon_account_invoice_change_currency-16.0.1.0.1.dist-info/WHEEL
+-rw-r--r--  2.0 unx        5 b- defN 23-May-26 16:19 odoo_addon_account_invoice_change_currency-16.0.1.0.1.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx     3221 b- defN 23-May-26 16:19 odoo_addon_account_invoice_change_currency-16.0.1.0.1.dist-info/RECORD
+27 files, 87730 bytes uncompressed, 31184 bytes compressed:  64.5%
```

## zipnote {}

```diff
@@ -63,20 +63,20 @@
 
 Filename: odoo/addons/account_invoice_change_currency/tests/test_account_invoice_change_currency.py
 Comment: 
 
 Filename: odoo/addons/account_invoice_change_currency/views/account_move_views.xml
 Comment: 
 
-Filename: odoo_addon_account_invoice_change_currency-15.0.2.0.0.4.dist-info/METADATA
+Filename: odoo_addon_account_invoice_change_currency-16.0.1.0.1.dist-info/METADATA
 Comment: 
 
-Filename: odoo_addon_account_invoice_change_currency-15.0.2.0.0.4.dist-info/WHEEL
+Filename: odoo_addon_account_invoice_change_currency-16.0.1.0.1.dist-info/WHEEL
 Comment: 
 
-Filename: odoo_addon_account_invoice_change_currency-15.0.2.0.0.4.dist-info/top_level.txt
+Filename: odoo_addon_account_invoice_change_currency-16.0.1.0.1.dist-info/top_level.txt
 Comment: 
 
-Filename: odoo_addon_account_invoice_change_currency-15.0.2.0.0.4.dist-info/RECORD
+Filename: odoo_addon_account_invoice_change_currency-16.0.1.0.1.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## odoo/addons/account_invoice_change_currency/README.rst

```diff
@@ -10,21 +10,21 @@
 .. |badge1| image:: https://img.shields.io/badge/maturity-Beta-yellow.png
     :target: https://odoo-community.org/page/development-status
     :alt: Beta
 .. |badge2| image:: https://img.shields.io/badge/licence-AGPL--3-blue.png
     :target: http://www.gnu.org/licenses/agpl-3.0-standalone.html
     :alt: License: AGPL-3
 .. |badge3| image:: https://img.shields.io/badge/github-OCA%2Faccount--invoicing-lightgray.png?logo=github
-    :target: https://github.com/OCA/account-invoicing/tree/15.0/account_invoice_change_currency
+    :target: https://github.com/OCA/account-invoicing/tree/16.0/account_invoice_change_currency
     :alt: OCA/account-invoicing
 .. |badge4| image:: https://img.shields.io/badge/weblate-Translate%20me-F47D42.png
-    :target: https://translation.odoo-community.org/projects/account-invoicing-15-0/account-invoicing-15-0-account_invoice_change_currency
+    :target: https://translation.odoo-community.org/projects/account-invoicing-16-0/account-invoicing-16-0-account_invoice_change_currency
     :alt: Translate me on Weblate
 .. |badge5| image:: https://img.shields.io/badge/runbot-Try%20me-875A7B.png
-    :target: https://runbot.odoo-community.org/runbot/95/15.0
+    :target: https://runbot.odoo-community.org/runbot/95/16.0
     :alt: Try me on Runbot
 
 |badge1| |badge2| |badge3| |badge4| |badge5| 
 
 ==================================
 Update currency of Account Invoice
 ==================================
@@ -62,15 +62,15 @@
 
 Bug Tracker
 ===========
 
 Bugs are tracked on `GitHub Issues <https://github.com/OCA/account-invoicing/issues>`_.
 In case of trouble, please check there if your issue has already been reported.
 If you spotted it first, help us smashing it by providing a detailed and welcomed
-`feedback <https://github.com/OCA/account-invoicing/issues/new?body=module:%20account_invoice_change_currency%0Aversion:%2015.0%0A%0A**Steps%20to%20reproduce**%0A-%20...%0A%0A**Current%20behavior**%0A%0A**Expected%20behavior**>`_.
+`feedback <https://github.com/OCA/account-invoicing/issues/new?body=module:%20account_invoice_change_currency%0Aversion:%2016.0%0A%0A**Steps%20to%20reproduce**%0A-%20...%0A%0A**Current%20behavior**%0A%0A**Expected%20behavior**>`_.
 
 Do not contact contributors directly about support or help with technical issues.
 
 Credits
 =======
 
 Authors
@@ -82,14 +82,15 @@
 Contributors
 ~~~~~~~~~~~~
 
 * Duc, Dao Dong <duc.dd@komit-consulting.com> (https://komit-consulting.com)
 * Hugo Adan <hugo@vauxoo.com>
 * Saran Lim. <saranl@ecosoft.co.th>
 * Rolando Duarte <rolando@vauxoo.com>
+* Luis J. Salvatierra <luis.salvatierra@factorlibre.com> (https://factorlibre.com)
 
 Maintainers
 ~~~~~~~~~~~
 
 This module is maintained by the OCA.
 
 .. image:: https://odoo-community.org/logo.png
@@ -107,10 +108,10 @@
     :target: https://github.com/rolandojduartem
     :alt: rolandojduartem
 
 Current `maintainers <https://odoo-community.org/page/maintainer-role>`__:
 
 |maintainer-luisg123v| |maintainer-rolandojduartem| 
 
-This module is part of the `OCA/account-invoicing <https://github.com/OCA/account-invoicing/tree/15.0/account_invoice_change_currency>`_ project on GitHub.
+This module is part of the `OCA/account-invoicing <https://github.com/OCA/account-invoicing/tree/16.0/account_invoice_change_currency>`_ project on GitHub.
 
 You are welcome to contribute. To learn how please visit https://odoo-community.org/page/Contribute.
```

## odoo/addons/account_invoice_change_currency/__manifest__.py

```diff
@@ -1,12 +1,12 @@
 # Copyright 2017 Komit <http://komit-consulting.com>
 # License AGPL-3.0 or later (https://www.gnu.org/licenses/agpl.html).
 {
     "name": "Account Invoice - Change Currency",
-    "version": "15.0.2.0.0",
+    "version": "16.0.1.0.1",
     "category": "Accounting & Finance",
     "summary": "Allows to change currency of Invoice by wizard",
     "author": "Vauxoo, Komit Consulting, Odoo Community Association (OCA)",
     "maintainers": ["luisg123v", "rolandojduartem"],
     "website": "https://github.com/OCA/account-invoicing",
     "license": "AGPL-3",
     "depends": ["account"],
```

## odoo/addons/account_invoice_change_currency/i18n/account_invoice_change_currency.pot

```diff
@@ -1,14 +1,14 @@
 # Translation of Odoo Server.
 # This file contains the translation of the following modules:
 # 	* account_invoice_change_currency
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: Odoo Server 15.0\n"
+"Project-Id-Version: Odoo Server 16.0\n"
 "Report-Msgid-Bugs-To: \n"
 "Last-Translator: \n"
 "Language-Team: \n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=UTF-8\n"
 "Content-Transfer-Encoding: \n"
 "Plural-Forms: \n"
```

## odoo/addons/account_invoice_change_currency/models/account_move.py

```diff
@@ -24,18 +24,20 @@
     )
     is_original_currency = fields.Boolean(
         compute="_compute_is_original_currency",
         help="Check if current currency is the original currency. "
         "This is used to hide custom rate field in the form view.",
     )
 
-    @api.model
-    def create(self, values):
-        values.setdefault("original_currency_id", values.get("currency_id"))
-        return super().create(values)
+    @api.model_create_multi
+    def create(self, vals_list):
+        for vals in vals_list:
+            if "currency_id" in vals and not vals.get("original_currency_id", False):
+                vals["original_currency_id"] = vals["currency_id"]
+        return super().create(vals_list)
 
     def action_account_change_currency(self):
         """
         This method convert the original price unit from the original
         currency when the invoice was created to the current currency
         using the custom rate and recompute all taxes.
         """
@@ -54,15 +56,14 @@
             for line in invoice.invoice_line_ids:
                 line.price_unit = original_currency._convert(
                     line.original_price_unit,
                     to_currency,
                     invoice.company_id,
                     invoice_date,
                 )
-            invoice._recompute_dynamic_lines(recompute_all_taxes=True)
 
     @api.depends("company_id", "currency_id", "invoice_date")
     def _compute_currency_change_rate(self):
         """
         Compute the custom rate from the original currency when the invoice
         was created to the current currency. The custom rate field is
         editable, but it will not change if custom rate is zero or the
```

## odoo/addons/account_invoice_change_currency/models/account_move_line.py

```diff
@@ -12,13 +12,14 @@
         "for the first time to use it to convert the "
         "amount in the new currency.",
     )
 
     @api.model_create_multi
     def create(self, vals_list):
         for vals in vals_list:
-            vals.setdefault("original_price_unit", vals.get("price_unit"))
+            if "price_unit" in vals:
+                vals["original_price_unit"] = vals["price_unit"]
         return super().create(vals_list)
 
     def _set_original_price_unit(self):
         for line in self:
             line.write({"original_price_unit": line.price_unit})
```

## odoo/addons/account_invoice_change_currency/readme/CONTRIBUTORS.rst

```diff
@@ -1,4 +1,5 @@
 * Duc, Dao Dong <duc.dd@komit-consulting.com> (https://komit-consulting.com)
 * Hugo Adan <hugo@vauxoo.com>
 * Saran Lim. <saranl@ecosoft.co.th>
 * Rolando Duarte <rolando@vauxoo.com>
+* Luis J. Salvatierra <luis.salvatierra@factorlibre.com> (https://factorlibre.com)
```

## odoo/addons/account_invoice_change_currency/static/description/index.html

### odoo/addons/account_invoice_change_currency/static/description/index.html

```diff
@@ -368,21 +368,21 @@
         <p>
           <a class="reference external" href="https://odoo-community.org/page/development-status">
             <img alt="Beta" src="https://img.shields.io/badge/maturity-Beta-yellow.png"/>
           </a>
           <a class="reference external" href="http://www.gnu.org/licenses/agpl-3.0-standalone.html">
             <img alt="License: AGPL-3" src="https://img.shields.io/badge/licence-AGPL--3-blue.png"/>
           </a>
-          <a class="reference external" href="https://github.com/OCA/account-invoicing/tree/15.0/account_invoice_change_currency">
+          <a class="reference external" href="https://github.com/OCA/account-invoicing/tree/16.0/account_invoice_change_currency">
             <img alt="OCA/account-invoicing" src="https://img.shields.io/badge/github-OCA%2Faccount--invoicing-lightgray.png?logo=github"/>
           </a>
-          <a class="reference external" href="https://translation.odoo-community.org/projects/account-invoicing-15-0/account-invoicing-15-0-account_invoice_change_currency">
+          <a class="reference external" href="https://translation.odoo-community.org/projects/account-invoicing-16-0/account-invoicing-16-0-account_invoice_change_currency">
             <img alt="Translate me on Weblate" src="https://img.shields.io/badge/weblate-Translate%20me-F47D42.png"/>
           </a>
-          <a class="reference external" href="https://runbot.odoo-community.org/runbot/95/15.0">
+          <a class="reference external" href="https://runbot.odoo-community.org/runbot/95/16.0">
             <img alt="Try me on Runbot" src="https://img.shields.io/badge/runbot-Try%20me-875A7B.png"/>
           </a>
         </p>
       </div>
       <div class="section" id="update-currency-of-account-invoice">
         <h1>Update currency of Account Invoice</h1>
         <p>This module allows users to update the currency of Invoices (in draft state) by
@@ -446,15 +446,15 @@
           </h2>
           <p>
             Bugs are tracked on
             <a class="reference external" href="https://github.com/OCA/account-invoicing/issues">GitHub Issues</a>
             .
 In case of trouble, please check there if your issue has already been reported.
 If you spotted it first, help us smashing it by providing a detailed and welcomed
-            <a class="reference external" href="https://github.com/OCA/account-invoicing/issues/new?body=module:%20account_invoice_change_currency%0Aversion:%2015.0%0A%0A**Steps%20to%20reproduce**%0A-%20...%0A%0A**Current%20behavior**%0A%0A**Expected%20behavior**">feedback</a>
+            <a class="reference external" href="https://github.com/OCA/account-invoicing/issues/new?body=module:%20account_invoice_change_currency%0Aversion:%2016.0%0A%0A**Steps%20to%20reproduce**%0A-%20...%0A%0A**Current%20behavior**%0A%0A**Expected%20behavior**">feedback</a>
             .
           </p>
           <p>Do not contact contributors directly about support or help with technical issues.</p>
         </div>
         <div class="section" id="credits">
           <h2>
             <a class="toc-backref" href="#id4">Credits</a>
@@ -491,14 +491,21 @@
                 &gt;
               </li>
               <li>
                 Rolando Duarte &lt;
                 <a class="reference external" href="mailto:rolando@vauxoo.com">rolando@vauxoo.com</a>
                 &gt;
               </li>
+              <li>
+                Luis J. Salvatierra &lt;
+                <a class="reference external" href="mailto:luis.salvatierra@factorlibre.com">luis.salvatierra@factorlibre.com</a>
+                &gt; (
+                <a class="reference external" href="https://factorlibre.com">https://factorlibre.com</a>
+                )
+              </li>
             </ul>
           </div>
           <div class="section" id="maintainers">
             <h3>
               <a class="toc-backref" href="#id7">Maintainers</a>
             </h3>
             <p>This module is maintained by the OCA.</p>
@@ -519,15 +526,15 @@
               </a>
               <a class="reference external" href="https://github.com/rolandojduartem">
                 <img alt="rolandojduartem" src="https://github.com/rolandojduartem.png?size=40px"/>
               </a>
             </p>
             <p>
               This module is part of the
-              <a class="reference external" href="https://github.com/OCA/account-invoicing/tree/15.0/account_invoice_change_currency">OCA/account-invoicing</a>
+              <a class="reference external" href="https://github.com/OCA/account-invoicing/tree/16.0/account_invoice_change_currency">OCA/account-invoicing</a>
               project on GitHub.
             </p>
             <p>
               You are welcome to contribute. To learn how please visit
               <a class="reference external" href="https://odoo-community.org/page/Contribute">https://odoo-community.org/page/Contribute</a>
               .
             </p>
```

## odoo/addons/account_invoice_change_currency/tests/test_account_invoice_change_currency.py

```diff
@@ -1,114 +1,35 @@
 # Copyright 2018 Komit <http://komit-consulting.com>
 # License AGPL-3.0 or later (https://www.gnu.org/licenses/agpl.html).
-import odoo.tests.common as common
 from odoo import fields
+from odoo.tests import tagged
 from odoo.tools import float_compare
 
+from odoo.addons.account.tests.common import AccountTestInvoicingCommon
 
-class TestAccountInvoiceChangeCurrency(common.TransactionCase):
-    def setUp(self):
-        super().setUp()
 
-        self.precision = self.env["decimal.precision"].precision_get("Payment Terms")
-        res_users_account_manager = self.env.ref("account.group_account_manager")
-        self.manager = (
-            self.env["res.users"]
-            .with_context(no_reset_password=True)
-            .create(
-                dict(
-                    name="Adviser",
-                    company_id=self.env.ref("base.main_company").id,
-                    login="fm",
-                    email="accountmanager@yourcompany.com",
-                    groups_id=[(6, 0, [res_users_account_manager.id])],
-                )
-            )
+@tagged("post_install", "-at_install")
+class TestAccountInvoiceChangeCurrency(AccountTestInvoicingCommon):
+    @classmethod
+    def setUpClass(cls, chart_template_ref=None):
+        super().setUpClass(chart_template_ref=chart_template_ref)
+        decimal_precision_name = (
+            cls.env["account.move.line"]._fields["price_unit"]._digits
         )
-
-        # Needed to create invoice
-        self.account_type = self.env["account.account.type"].create(
-            {
-                "name": "acc type test 2",
-                "type": "other",
-                "include_initial_balance": True,
-                "internal_group": "asset",
-            }
-        )
-        self.account_account_line = self.env["account.account"].create(
-            {
-                "name": "acc inv line test",
-                "code": "X2021",
-                "user_type_id": self.account_type.id,
-                "reconcile": True,
-            }
+        decimal_precision = cls.env["decimal.precision"].search(
+            [("name", "=", decimal_precision_name)]
         )
-        self.product_1 = self.env["product.product"].create({"name": "Product 1"})
-        self.product_2 = self.env["product.product"].create({"name": "Product 2"})
-        self.analytic_account = self.env["account.analytic.account"].create(
-            {"name": "test account"}
-        )
-        self.tax_account = self.env["account.account"].search(
-            [
-                (
-                    "user_type_id",
-                    "=",
-                    self.env.ref("account.data_account_type_current_assets").id,
-                )
-            ],
-            limit=1,
-        )
-
-    def create_simple_invoice(self, date=False, context=None, inv_type=None):
-        if not context:
-            context = {}
-        context["default_move_type"] = True
-        invoice_lines = [
-            (
-                0,
-                0,
-                {
-                    "product_id": self.product_1.id,
-                    "quantity": 5.0,
-                    "price_unit": 142.0,
-                    "name": "Product that cost 142",
-                    "account_id": self.account_account_line.id,
-                },
-            ),
-            (
-                0,
-                0,
-                {
-                    "product_id": self.product_2.id,
-                    "quantity": 4.0,
-                    "price_unit": 213.0,
-                    "name": "Product that cost 213",
-                    "account_id": self.account_account_line.id,
-                },
-            ),
-        ]
-        invoice = (
-            self.env["account.move"]
-            .with_user(self.manager)
-            .with_context(**context)
-            .create(
-                {
-                    "partner_id": 1,
-                    "move_type": inv_type or "in_invoice",
-                    "invoice_date": date,
-                    "currency_id": self.env.ref("base.EUR").id,
-                    "invoice_line_ids": invoice_lines,
-                    "state": "draft",
-                }
-            )
-        )
-        return invoice
+        cls.precision = decimal_precision.digits
 
     def test_change_invoice_currency(self):
-        inv = self.create_simple_invoice(fields.Date.today())
+        inv = self.init_invoice(
+            "out_invoice",
+            products=self.product_a + self.product_b,
+            invoice_date=fields.Date.today(),
+        )
         before_curr = inv.currency_id
         before_amount = inv.amount_total
         after_curr = self.env.ref("base.USD")
         inv.write({"currency_id": after_curr.id})
         inv.action_account_change_currency()
         expected_value = before_curr._convert(
             before_amount, after_curr, inv.company_id, fields.Date.today()
@@ -116,102 +37,93 @@
         self.assertEqual(
             float_compare(inv.amount_total, expected_value, 0),
             0,
             "Total amount of invoice does not match to the expected value",
         )
 
     def test_change_validated_invoice_currency(self):
-        inv = self.create_simple_invoice(fields.Date.today())
+        inv = self.init_invoice(
+            "out_invoice",
+            products=self.product_a + self.product_b,
+            invoice_date=fields.Date.today(),
+        )
         before_amount = inv.amount_total
         inv.action_post()
         # Make sure that we can not change the currency after validated:
         inv.write({"currency_id": self.env.ref("base.USD").id})
         inv.action_account_change_currency()
         self.assertEqual(
             inv.amount_total,
             before_amount,
             "Total amount of invoice does not match to the expected value",
         )
 
     def test_create_invoice_update_currency(self):
-        inv = self.create_simple_invoice()
+        inv = self.init_invoice(
+            "out_invoice",
+            products=self.product_a + self.product_b,
+            invoice_date=fields.Date.today(),
+        )
         before_amount = inv.amount_total
         inv.action_account_change_currency()
         self.assertEqual(
             inv.amount_total,
             before_amount,
             "Amount must remain the same, because no currency changes",
         )
 
     def test_custom_rate_update_currency(self):
-        inv = self.create_simple_invoice(fields.Date.today())
+        inv = self.init_invoice(
+            "out_invoice",
+            products=self.product_a + self.product_b,
+            invoice_date=fields.Date.today(),
+        )
         before_amount = inv.amount_total
-        after_curr = self.env.ref("base.USD")
+        self.assertEqual(inv.original_currency_id, self.env.ref("base.USD"))
+        after_curr = self.env.ref("base.EUR")
         custom_rate = 1.13208
         inv.write({"currency_id": after_curr.id, "custom_rate": custom_rate})
         inv.write({"custom_rate": custom_rate})
         inv.action_account_change_currency()
         expected_value = before_amount * custom_rate
-        # TODO: Check float comparation, 12013.64 vs 12013.632959999999
         self.assertEqual(
             float_compare(inv.amount_total, expected_value, self.precision),
-            1,
+            0,
             "Total amount of invoice does not match to the expected value",
         )
 
     def test_custom_rate_zero_update_currency(self):
-        inv = self.create_simple_invoice()
+        inv = self.init_invoice(
+            "out_invoice",
+            products=self.product_a + self.product_b,
+            invoice_date=fields.Date.today(),
+        )
         before_amount = inv.amount_total
         before_curr = inv.currency_id
         custom_rate = 0.0
         usd = self.env.ref("base.USD")
         eur = self.env.ref("base.EUR")
         inv.write({"currency_id": usd.id, "custom_rate": custom_rate})
-        inv.write({"custom_rate": custom_rate})
         inv.action_account_change_currency()
         expected_value = before_curr._convert(
             before_amount, usd, inv.company_id, fields.Date.today()
         )
-        # Comparison 2004.64 vs 2004.67
         self.assertEqual(
-            float_compare(inv.amount_total, expected_value, 0),
+            float_compare(inv.amount_total, expected_value, self.precision),
             0,
             "Total amount of invoice does not match to the expected value",
         )
         # Change currency and set custom rate 0
         inv.write({"currency_id": eur.id, "custom_rate": custom_rate})
-        inv.write({"custom_rate": custom_rate})
         inv.action_account_change_currency()
         self.assertEqual(
             inv.amount_total,
             before_amount,
             "Total amount of invoice does not match to the expected value",
         )
-        # Change Again custom rate with old_rate but now without new currency
-        inv.write({"custom_rate": custom_rate})
-        inv.action_account_change_currency()
-        expected_value = before_curr._convert(
-            before_amount, eur, inv.company_id, fields.Date.today()
-        )
-        self.assertEqual(
-            inv.amount_total,
-            expected_value,
-            "Total amount of invoice does not match to the expected value",
-        )
-        # Custom rate with 0 but now without new currency
-        inv.write({"custom_rate": custom_rate})
-        inv.action_account_change_currency()
-        expected_value = before_curr._convert(
-            before_amount, eur, inv.company_id, fields.Date.today()
-        )
-        self.assertEqual(
-            inv.amount_total,
-            before_amount,
-            "Total amount of invoice does not match to the expected value",
-        )
         # keep old_rate but now we update the currency.rate
         # (Original currency rate can not be changed anymore)
         before_amount = inv.amount_total
         old_rate = custom_rate
         new_rate = 1.6299
         usd_updated_rate = self.env["res.currency.rate"].create(
             {
@@ -220,19 +132,18 @@
                 "currency_id": usd.id,
                 "company_id": inv.company_id.id,
             }
         )
         rate = usd_updated_rate.rate
         inv.write({"custom_rate": rate})
         inv.action_account_change_currency()
-        expected_value = before_amount
-        # TODO: Check float comparation, 1562.0 vs 1562.0
+        expected_value = before_amount * rate
         self.assertEqual(
-            inv.amount_total,
-            expected_value,
+            float_compare(inv.amount_total, expected_value, 1),
+            0,
             "Total amount of invoice does not match to the expected value",
         )
         # change custom rate then we trigger the conversion 2 times
         # The currency.rate modification above will be ignored and keep the
         # custom rate
         old_rate = inv.custom_rate
         inv.write({"currency_id": usd.id, "custom_rate": rate})
@@ -246,49 +157,48 @@
             0,
             "Total amount of invoice does not match to the expected value",
         )
         before_amount = inv.amount_total
         rate = old_rate + 1
         inv.write({"custom_rate": rate})
         inv.action_account_change_currency()
-        expected_value = before_amount * rate / old_rate
-        # TODO: Check float comparation, 4107.93 vs 4107.946074605804
+        expected_value = before_amount
         self.assertEqual(
             float_compare(inv.amount_total, expected_value, 1),
             0,
             "Total amount of invoice does not match to the expected value",
         )
         inv.action_account_change_currency()
-        # TODO: Check float comparation, 4107.93 vs 4107.946074605804
         self.assertEqual(
             float_compare(inv.amount_total, expected_value, 1),
             0,
             "Total amount of invoice does not match to the expected value",
         )
-        # Test if there are no currency
-        inv.write({"currency_id": False})
-        self.assertEqual(
-            inv.custom_rate,
-            1.0,
-            "Custom rate of invoice does not match to the expected value",
-        )
 
     def test_not_currency_change(self):
-        inv = self.create_simple_invoice(inv_type="out_invoice")
+        inv = self.init_invoice(
+            "out_invoice",
+            products=self.product_a + self.product_b,
+            invoice_date=fields.Date.today(),
+        )
         before_amount = inv.amount_total
         inv.action_account_change_currency()
         self.assertEqual(
             inv.amount_total,
             before_amount,
             "Amount must remain the same, because None change was made",
         )
 
     def test_old_invoices(self):
         # This simulate an old invoice (no stored original values)
-        inv = self.create_simple_invoice(fields.Date.today())
+        inv = self.init_invoice(
+            "out_invoice",
+            products=self.product_a + self.product_b,
+            invoice_date=fields.Date.today(),
+        )
         inv.write({"original_currency_id": False})
         inv.invoice_line_ids.write({"original_price_unit": False})
         self.assertFalse(
             inv.original_currency_id,
             "There is an original currency in the invoice",
         )
         self.assertEqual(
```

## Comparing `odoo_addon_account_invoice_change_currency-15.0.2.0.0.4.dist-info/METADATA` & `odoo_addon_account_invoice_change_currency-16.0.1.0.1.dist-info/METADATA`

 * *Files 6% similar despite different names*

```diff
@@ -1,22 +1,22 @@
 Metadata-Version: 2.1
 Name: odoo-addon-account-invoice-change-currency
-Version: 15.0.2.0.0.4
+Version: 16.0.1.0.1
 Summary: Allows to change currency of Invoice by wizard
 Home-page: https://github.com/OCA/account-invoicing
 Author: Vauxoo, Komit Consulting, Odoo Community Association (OCA)
 Author-email: support@odoo-community.org
 License: AGPL-3
 Platform: UNKNOWN
 Classifier: Programming Language :: Python
 Classifier: Framework :: Odoo
-Classifier: Framework :: Odoo :: 15.0
+Classifier: Framework :: Odoo :: 16.0
 Classifier: License :: OSI Approved :: GNU Affero General Public License v3
-Requires-Python: >=3.8
-Requires-Dist: odoo (<15.1dev,>=15.0a)
+Requires-Python: >=3.10
+Requires-Dist: odoo (<16.1dev,>=16.0a)
 
 =================================
 Account Invoice - Change Currency
 =================================
 
 .. !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    !! This file is generated by oca-gen-addon-readme !!
@@ -26,21 +26,21 @@
 .. |badge1| image:: https://img.shields.io/badge/maturity-Beta-yellow.png
     :target: https://odoo-community.org/page/development-status
     :alt: Beta
 .. |badge2| image:: https://img.shields.io/badge/licence-AGPL--3-blue.png
     :target: http://www.gnu.org/licenses/agpl-3.0-standalone.html
     :alt: License: AGPL-3
 .. |badge3| image:: https://img.shields.io/badge/github-OCA%2Faccount--invoicing-lightgray.png?logo=github
-    :target: https://github.com/OCA/account-invoicing/tree/15.0/account_invoice_change_currency
+    :target: https://github.com/OCA/account-invoicing/tree/16.0/account_invoice_change_currency
     :alt: OCA/account-invoicing
 .. |badge4| image:: https://img.shields.io/badge/weblate-Translate%20me-F47D42.png
-    :target: https://translation.odoo-community.org/projects/account-invoicing-15-0/account-invoicing-15-0-account_invoice_change_currency
+    :target: https://translation.odoo-community.org/projects/account-invoicing-16-0/account-invoicing-16-0-account_invoice_change_currency
     :alt: Translate me on Weblate
 .. |badge5| image:: https://img.shields.io/badge/runbot-Try%20me-875A7B.png
-    :target: https://runbot.odoo-community.org/runbot/95/15.0
+    :target: https://runbot.odoo-community.org/runbot/95/16.0
     :alt: Try me on Runbot
 
 |badge1| |badge2| |badge3| |badge4| |badge5| 
 
 ==================================
 Update currency of Account Invoice
 ==================================
@@ -78,15 +78,15 @@
 
 Bug Tracker
 ===========
 
 Bugs are tracked on `GitHub Issues <https://github.com/OCA/account-invoicing/issues>`_.
 In case of trouble, please check there if your issue has already been reported.
 If you spotted it first, help us smashing it by providing a detailed and welcomed
-`feedback <https://github.com/OCA/account-invoicing/issues/new?body=module:%20account_invoice_change_currency%0Aversion:%2015.0%0A%0A**Steps%20to%20reproduce**%0A-%20...%0A%0A**Current%20behavior**%0A%0A**Expected%20behavior**>`_.
+`feedback <https://github.com/OCA/account-invoicing/issues/new?body=module:%20account_invoice_change_currency%0Aversion:%2016.0%0A%0A**Steps%20to%20reproduce**%0A-%20...%0A%0A**Current%20behavior**%0A%0A**Expected%20behavior**>`_.
 
 Do not contact contributors directly about support or help with technical issues.
 
 Credits
 =======
 
 Authors
@@ -98,14 +98,15 @@
 Contributors
 ~~~~~~~~~~~~
 
 * Duc, Dao Dong <duc.dd@komit-consulting.com> (https://komit-consulting.com)
 * Hugo Adan <hugo@vauxoo.com>
 * Saran Lim. <saranl@ecosoft.co.th>
 * Rolando Duarte <rolando@vauxoo.com>
+* Luis J. Salvatierra <luis.salvatierra@factorlibre.com> (https://factorlibre.com)
 
 Maintainers
 ~~~~~~~~~~~
 
 This module is maintained by the OCA.
 
 .. image:: https://odoo-community.org/logo.png
@@ -123,12 +124,12 @@
     :target: https://github.com/rolandojduartem
     :alt: rolandojduartem
 
 Current `maintainers <https://odoo-community.org/page/maintainer-role>`__:
 
 |maintainer-luisg123v| |maintainer-rolandojduartem| 
 
-This module is part of the `OCA/account-invoicing <https://github.com/OCA/account-invoicing/tree/15.0/account_invoice_change_currency>`_ project on GitHub.
+This module is part of the `OCA/account-invoicing <https://github.com/OCA/account-invoicing/tree/16.0/account_invoice_change_currency>`_ project on GitHub.
 
 You are welcome to contribute. To learn how please visit https://odoo-community.org/page/Contribute.
```

## Comparing `odoo_addon_account_invoice_change_currency-15.0.2.0.0.4.dist-info/RECORD` & `odoo_addon_account_invoice_change_currency-16.0.1.0.1.dist-info/RECORD`

 * *Files 4% similar despite different names*

```diff
@@ -1,27 +1,27 @@
-odoo/addons/account_invoice_change_currency/README.rst,sha256=O61Pn4RecU8imhS5Vb5gee76pr2LQWqPeC6vsgRfkJ4,4381
+odoo/addons/account_invoice_change_currency/README.rst,sha256=EOaEhIYXlIeyPc55E0okzbdAtfBXyef0tLPSMb7TNB4,4464
 odoo/addons/account_invoice_change_currency/__init__.py,sha256=qVLMP169CsXxA3Xh4HmSIJV0wBheXuteOEn1uNypDS8,177
-odoo/addons/account_invoice_change_currency/__manifest__.py,sha256=0QjmHg3YFBgI37duDd73HizvArmT1Bjew77esGaHvTQ,675
+odoo/addons/account_invoice_change_currency/__manifest__.py,sha256=nfIKFiCr49lZE53Y0gYvaQdrUQp717wL2fuif62qfsI,675
 odoo/addons/account_invoice_change_currency/hooks.py,sha256=wbssjB5JToPF0izy7WnG7ohJKJ3m-TpcuRGmDAc-4fY,656
-odoo/addons/account_invoice_change_currency/i18n/account_invoice_change_currency.pot,sha256=2mZCBNmpGWZDmUZqaGsmRm3ycm3U_w8uPXlYfGHhDVk,4766
+odoo/addons/account_invoice_change_currency/i18n/account_invoice_change_currency.pot,sha256=wBjvNl3JZ9MEx2TNDi_L_IHEV7b78hpQIA9PkA98hZA,4766
 odoo/addons/account_invoice_change_currency/i18n/ca.po,sha256=L2Cq0k6cri2oj2MZa4x2kk5C1huX1NL_8nHKDyhZDNc,5465
 odoo/addons/account_invoice_change_currency/i18n/de.po,sha256=q_SIiNFxRoJRp9m6OWFoNChNTZELUG62szNgi04POnM,5547
 odoo/addons/account_invoice_change_currency/i18n/es.po,sha256=6gJp_-YAvJmnCL5d6X4xviLPTweOqr-CmAQAXtoaioc,5733
 odoo/addons/account_invoice_change_currency/i18n/es_MX.po,sha256=aJtozGIhRZEXN5y0iuNNI3v_sWtnEyCwYuNYf2IA63g,4842
 odoo/addons/account_invoice_change_currency/i18n/hr.po,sha256=Wtoio2-PHFC3JerV6jy8Z4TM_7_5OgJ7C16vy_Suj08,5310
 odoo/addons/account_invoice_change_currency/models/__init__.py,sha256=e3jL4R_UxVYPzpmgpfjMbMrl3CPiHkc06ff6DlN0Auc,86
-odoo/addons/account_invoice_change_currency/models/account_move.py,sha256=ULFOaW8AB0N3QOtD2pvyGf6l_LHAA97_x0rLUAjcd-s,3929
-odoo/addons/account_invoice_change_currency/models/account_move_line.py,sha256=7kebpzNhRmrxPse8kpmeNPtd9_g1Clqp17FUgbCspGY,805
+odoo/addons/account_invoice_change_currency/models/account_move.py,sha256=MZ7zN0fl9wDBlBJB455I3ShpLoe0X3wdHa8FjRRfhPY,3984
+odoo/addons/account_invoice_change_currency/models/account_move_line.py,sha256=39jfjQ79Cx3POIAyzRivBxg5HzyS0XFrtqgKER5l7sM,832
 odoo/addons/account_invoice_change_currency/models/res_currency.py,sha256=sDE5TRS-6bKtOa8N7zKB7mgBD7p5f0wWemAHPzq_RF0,701
 odoo/addons/account_invoice_change_currency/readme/CONFIGURE.rst,sha256=rEZsKnnDSeiro2QFlodDZWhdT6ryVN5ydmpr1fwjHds,99
-odoo/addons/account_invoice_change_currency/readme/CONTRIBUTORS.rst,sha256=orgKwzV6Uy2Uw1We_4oL2bpkbG5r19NbGoxY9YfdioQ,181
+odoo/addons/account_invoice_change_currency/readme/CONTRIBUTORS.rst,sha256=3JY9ZQXt1yegWQMCvgrRjRvB1J9NZ4vBsp5RHUCzCr0,264
 odoo/addons/account_invoice_change_currency/readme/DESCRIPTION.rst,sha256=UWJqL1D0wfuOZISmMdbYrfXS-RT-98gquRCQXhGOzSA,742
 odoo/addons/account_invoice_change_currency/readme/USAGE.rst,sha256=e4aTC63G5niyaFyuAN3qgD1-GL_w3KgiNNnLoKXSubo,179
 odoo/addons/account_invoice_change_currency/static/description/icon.png,sha256=6xBPJauaFOF0KDHfHgQopSc28kKvxMaeoQFQWZtfZDo,9455
-odoo/addons/account_invoice_change_currency/static/description/index.html,sha256=1sQ0PoyWRH5fGDmibVG-RdHccKC_WXy7YzlhFQwm_ZA,14190
+odoo/addons/account_invoice_change_currency/static/description/index.html,sha256=gs2JEi-DpeHy8WJH-MmU6GsTqSSXD6XVgGUEzajOsMs,14440
 odoo/addons/account_invoice_change_currency/tests/__init__.py,sha256=HmVFRX25mTF1ixgsmw2w2-ZC_7jUnEGLuHIbFlvtBgY,174
-odoo/addons/account_invoice_change_currency/tests/test_account_invoice_change_currency.py,sha256=m6sjToGj3GWhWT58GaEsLY2-HkcbQZjRkF33-mMh-TE,12032
+odoo/addons/account_invoice_change_currency/tests/test_account_invoice_change_currency.py,sha256=HFL_hFkEe9fCAtgpj0v3Pmbw3kGSm_z39aT4Dif0yB0,8605
 odoo/addons/account_invoice_change_currency/views/account_move_views.xml,sha256=MDmT49uHl-GGgqx59mHMZ0wS6q8kw_dAvmaHPf-HINk,2158
-odoo_addon_account_invoice_change_currency-15.0.2.0.0.4.dist-info/METADATA,sha256=PyoaS3qH5X4xpbgdvnF-D7yrwDilu8Zy36cp30rn8pU,4976
-odoo_addon_account_invoice_change_currency-15.0.2.0.0.4.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
-odoo_addon_account_invoice_change_currency-15.0.2.0.0.4.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
-odoo_addon_account_invoice_change_currency-15.0.2.0.0.4.dist-info/RECORD,,
+odoo_addon_account_invoice_change_currency-16.0.1.0.1.dist-info/METADATA,sha256=pL7Y-zmClBkhmiv1mSYyut2pBdeTJlin5qwrFnQQC7I,5058
+odoo_addon_account_invoice_change_currency-16.0.1.0.1.dist-info/WHEEL,sha256=2wepM1nk4DS4eFpYrW1TTqPcoGNfHhhO_i5m4cOimbo,92
+odoo_addon_account_invoice_change_currency-16.0.1.0.1.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
+odoo_addon_account_invoice_change_currency-16.0.1.0.1.dist-info/RECORD,,
```

