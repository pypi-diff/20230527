# Comparing `tmp/siat-2.0.7-py3-none-any.whl.zip` & `tmp/siat-2.0.8-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,8 +1,8 @@
-Zip file size: 1135604 bytes, number of entries: 118
+Zip file size: 1135979 bytes, number of entries: 118
 -rw-rw-rw-  2.0 fat      840 b- defN 23-Apr-10 11:29 siat/__init__.py
 -rw-rw-rw-  2.0 fat     2130 b- defN 23-Apr-10 11:29 siat/allin.py
 -rw-rw-rw-  2.0 fat      747 b- defN 23-Apr-10 11:29 siat/alpha_vantage_test.py
 -rw-rw-rw-  2.0 fat    28555 b- defN 23-Apr-10 11:29 siat/assets_liquidity.py
 -rw-rw-rw-  2.0 fat     1285 b- defN 23-Apr-10 11:29 siat/assets_liquidity_test.py
 -rw-rw-rw-  2.0 fat    10110 b- defN 23-Apr-10 11:29 siat/barrons_scraping_test.py
 -rw-rw-rw-  2.0 fat    36597 b- defN 23-Apr-10 11:29 siat/beta_adjustment.py
@@ -31,16 +31,16 @@
 -rw-rw-rw-  2.0 fat    18941 b- defN 23-Apr-10 11:29 siat/esg.py
 -rw-rw-rw-  2.0 fat     2944 b- defN 23-Apr-10 11:29 siat/esg_test.py
 -rw-rw-rw-  2.0 fat    47177 b- defN 23-Apr-10 11:29 siat/fama_french.py
 -rw-rw-rw-  2.0 fat     4678 b- defN 23-Apr-10 11:29 siat/fama_french_test.py
 -rw-rw-rw-  2.0 fat    40695 b- defN 23-Apr-10 11:29 siat/financial_base.py
 -rw-rw-rw-  2.0 fat    21528 b- defN 23-Apr-10 11:29 siat/financial_statements.py
 -rw-rw-rw-  2.0 fat      716 b- defN 23-Apr-10 11:29 siat/financial_statements_test.py
--rw-rw-rw-  2.0 fat    76676 b- defN 23-Apr-10 11:29 siat/financials.py
--rw-rw-rw-  2.0 fat   173542 b- defN 23-May-08 10:16 siat/financials_china.py
+-rw-rw-rw-  2.0 fat    77162 b- defN 23-May-27 08:24 siat/financials.py
+-rw-rw-rw-  2.0 fat   173961 b- defN 23-May-27 10:00 siat/financials_china.py
 -rw-rw-rw-  2.0 fat    60037 b- defN 23-Apr-23 05:59 siat/financials_china2.py
 -rw-rw-rw-  2.0 fat     2722 b- defN 23-Apr-10 11:29 siat/financials_china2_test.py
 -rw-rw-rw-  2.0 fat     3507 b- defN 23-Apr-10 11:29 siat/financials_china2_test2.py
 -rw-rw-rw-  2.0 fat     3118 b- defN 23-Apr-10 11:29 siat/financials_china2_test3.py
 -rw-rw-rw-  2.0 fat    17549 b- defN 23-Apr-10 11:29 siat/financials_china_test.py
 -rw-rw-rw-  2.0 fat     5924 b- defN 23-Apr-19 09:54 siat/financials_china_test2.py
 -rw-rw-rw-  2.0 fat     5924 b- defN 23-Apr-19 09:55 siat/financials_china_test2_fin_indicator.py
@@ -70,28 +70,28 @@
 -rw-rw-rw-  2.0 fat    95158 b- defN 23-May-24 14:28 siat/option_china.py
 -rw-rw-rw-  2.0 fat    16355 b- defN 23-Apr-10 11:29 siat/option_china_test.py
 -rw-rw-rw-  2.0 fat    69625 b- defN 23-Apr-10 11:29 siat/option_pricing.py
 -rw-rw-rw-  2.0 fat     2203 b- defN 23-Apr-10 11:29 siat/option_pricing_test.py
 -rw-rw-rw-  2.0 fat     5908 b- defN 23-Apr-10 11:29 siat/option_sina_api_test.py
 -rw-rw-rw-  2.0 fat     2610 b- defN 23-Apr-10 11:29 siat/proxy_test.py
 -rw-rw-rw-  2.0 fat     1552 b- defN 23-Apr-10 11:29 siat/quandl_test.py
--rw-rw-rw-  2.0 fat    49073 b- defN 23-Apr-10 11:29 siat/risk_adjusted_return.py
+-rw-rw-rw-  2.0 fat    49073 b- defN 23-May-26 05:11 siat/risk_adjusted_return.py
 -rw-rw-rw-  2.0 fat     3416 b- defN 23-Apr-10 11:29 siat/risk_adjusted_return_test.py
 -rw-rw-rw-  2.0 fat    75061 b- defN 23-Apr-10 11:29 siat/risk_evaluation.py
 -rw-rw-rw-  2.0 fat     3731 b- defN 23-Apr-10 11:29 siat/risk_evaluation_test.py
 -rw-rw-rw-  2.0 fat    12304 b- defN 23-Apr-10 11:29 siat/risk_free_rate.py
 -rw-rw-rw-  2.0 fat     4285 b- defN 23-Apr-10 11:29 siat/risk_free_rate_test.py
--rw-rw-rw-  2.0 fat   100084 b- defN 23-May-04 05:22 siat/sector_china.py
+-rw-rw-rw-  2.0 fat   101523 b- defN 23-May-27 06:22 siat/sector_china.py
 -rw-rw-rw-  2.0 fat     5843 b- defN 23-Apr-11 14:17 siat/sector_china_test.py
 -rw-rw-rw-  2.0 fat    29185 b- defN 23-May-25 02:36 siat/security_price.py
 -rw-rw-rw-  2.0 fat    71984 b- defN 23-May-22 08:26 siat/security_prices.py
 -rw-rw-rw-  2.0 fat    10779 b- defN 23-Apr-10 11:29 siat/security_prices_test.py
 -rw-rw-rw-  2.0 fat     1335 b- defN 23-Apr-10 11:29 siat/setup.py
 -rw-rw-rw-  2.0 fat     1418 b- defN 23-Apr-10 11:29 siat/shenwan index history test.py
--rw-rw-rw-  2.0 fat   117962 b- defN 23-May-25 08:18 siat/stock.py
+-rw-rw-rw-  2.0 fat   118039 b- defN 23-May-26 00:50 siat/stock.py
 -rw-rw-rw-  2.0 fat    31655 b- defN 23-Apr-10 11:29 siat/stock_advice_linear.py
 -rw-rw-rw-  2.0 fat     1312 b- defN 23-Apr-10 11:29 siat/stock_base.py
 -rw-rw-rw-  2.0 fat    68123 b- defN 23-Apr-10 11:29 siat/stock_china.py
 -rw-rw-rw-  2.0 fat     1276 b- defN 23-Apr-10 11:29 siat/stock_china_test.py
 -rw-rw-rw-  2.0 fat  1242926 b- defN 23-Apr-10 11:29 siat/stock_info.pickle
 -rw-rw-rw-  2.0 fat     6122 b- defN 23-Apr-10 11:29 siat/stock_info_test.py
 -rw-rw-rw-  2.0 fat     1014 b- defN 23-Apr-10 11:29 siat/stock_list_china_test.py
@@ -109,12 +109,12 @@
 -rw-rw-rw-  2.0 fat   118133 b- defN 23-Apr-10 11:29 siat/translate-20230206.py
 -rw-rw-rw-  2.0 fat   121657 b- defN 23-Apr-10 11:29 siat/translate-20230215.py
 -rw-rw-rw-  2.0 fat   126254 b- defN 23-May-25 03:25 siat/translate.py
 -rw-rw-rw-  2.0 fat     3936 b- defN 23-Apr-10 11:29 siat/universal_test.py
 -rw-rw-rw-  2.0 fat    51342 b- defN 23-May-11 00:30 siat/valuation_china.py
 -rw-rw-rw-  2.0 fat     1571 b- defN 23-Apr-10 11:29 siat/valuation_market_china_test.py
 -rw-rw-rw-  2.0 fat    14859 b- defN 23-Apr-10 11:29 siat/var_model_validation.py
--rw-rw-rw-  2.0 fat     1399 b- defN 23-May-25 14:01 siat-2.0.7.dist-info/METADATA
--rw-rw-rw-  2.0 fat       92 b- defN 23-May-25 14:01 siat-2.0.7.dist-info/WHEEL
--rw-rw-rw-  2.0 fat        5 b- defN 23-May-25 14:01 siat-2.0.7.dist-info/top_level.txt
-?rw-rw-r--  2.0 fat     9429 b- defN 23-May-25 14:01 siat-2.0.7.dist-info/RECORD
-118 files, 4474570 bytes uncompressed, 1121222 bytes compressed:  75.0%
+-rw-rw-rw-  2.0 fat     1399 b- defN 23-May-27 11:16 siat-2.0.8.dist-info/METADATA
+-rw-rw-rw-  2.0 fat       92 b- defN 23-May-27 11:16 siat-2.0.8.dist-info/WHEEL
+-rw-rw-rw-  2.0 fat        5 b- defN 23-May-27 11:16 siat-2.0.8.dist-info/top_level.txt
+?rw-rw-r--  2.0 fat     9429 b- defN 23-May-27 11:16 siat-2.0.8.dist-info/RECORD
+118 files, 4476991 bytes uncompressed, 1121597 bytes compressed:  75.0%
```

## zipnote {}

```diff
@@ -336,20 +336,20 @@
 
 Filename: siat/valuation_market_china_test.py
 Comment: 
 
 Filename: siat/var_model_validation.py
 Comment: 
 
-Filename: siat-2.0.7.dist-info/METADATA
+Filename: siat-2.0.8.dist-info/METADATA
 Comment: 
 
-Filename: siat-2.0.7.dist-info/WHEEL
+Filename: siat-2.0.8.dist-info/WHEEL
 Comment: 
 
-Filename: siat-2.0.7.dist-info/top_level.txt
+Filename: siat-2.0.8.dist-info/top_level.txt
 Comment: 
 
-Filename: siat-2.0.7.dist-info/RECORD
+Filename: siat-2.0.8.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## siat/financials.py

```diff
@@ -174,31 +174,35 @@
     import datetime; today=datetime.date.today()
     #绘图：T1I1，单折线
     if mode == 'T1I1':
         df=df1
         colname=item1
         collabel=ectranslate(item1)
         ylabeltxt=''
-        titletxt=codetranslate(ticker1)+texttranslate(": 基于年(季)报的业绩历史")
-        footnote=texttranslate("数据来源: 雅虎财经,")+' '+str(today)
+        #titletxt=codetranslate(ticker1)+texttranslate(": 基于年(季)报的业绩历史")
+        titletxt=codetranslate(ticker1)+": 基于财务报表的业绩历史"
+        #footnote=texttranslate("数据来源: 雅虎财经,")+' '+str(today)
+        footnote="数据来源: 雅虎财经,"+' '+str(today)
         
         plot_line(df,colname,collabel,ylabeltxt,titletxt,footnote, \
                   datatag=datatag,power=power,zeroline=zeroline,resample_freq='3M', \
                       loc=loc1)
         return df1,None
 
     #绘图：T1I2，单股票双折线
     if mode == 'T1I2':
         colname1=item1
         label1=ectranslate(item1)
         colname2=item2
         label2=ectranslate(item2)
         ylabeltxt=''
-        titletxt=codetranslate(ticker1)+texttranslate(": 基于年(季)报的业绩历史对比")
-        footnote=texttranslate("数据来源: 雅虎财经,")+' '+str(today)
+        #titletxt=codetranslate(ticker1)+texttranslate(": 基于年(季)报的业绩历史对比")
+        titletxt=codetranslate(ticker1)+": 基于财务报表的业绩历史对比"
+        #footnote=texttranslate("数据来源: 雅虎财经,")+' '+str(today)
+        footnote="数据来源: 雅虎财经,"+' '+str(today)
         
         plot_line2(df1,ticker1,colname1,label1, \
                df2,ticker2,colname2,label2, \
                ylabeltxt,titletxt,footnote, \
                power=power,zeroline=zeroline,twinx=twinx,resample_freq='3M', \
                    loc1=loc1,loc2=loc2)
         return df1,df2
@@ -225,16 +229,18 @@
         """
         
         colname1=item1
         label1=ectranslate(item1)
         colname2=item2
         label2=ectranslate(item2)
         ylabeltxt=''
-        titletxt=codetranslate(ticker1)+" vs "+codetranslate(ticker2)+texttranslate(": 基于年(季)报的业绩历史对比")
-        footnote=texttranslate("数据来源: 雅虎财经,")+' '+str(today)
+        #titletxt=codetranslate(ticker1)+" vs "+codetranslate(ticker2)+texttranslate(": 基于年(季)报的业绩历史对比")
+        titletxt=codetranslate(ticker1)+" vs "+codetranslate(ticker2)+": 基于财务报表的业绩历史对比"
+        #footnote=texttranslate("数据来源: 雅虎财经,")+' '+str(today)
+        footnote="数据来源: 雅虎财经,"+' '+str(today)
         
         plot_line2(df1,ticker1,colname1,label1, \
                df2,ticker2,colname2,label2, \
                ylabeltxt,titletxt,footnote, \
                power=power,zeroline=zeroline,twinx=twinx,resample_freq='3M', \
                    loc1=loc1,loc2=loc2)    
     
@@ -423,20 +429,21 @@
         foundlist=[]
         for t in tickers:
             if not (t in notfoundlist):
                 foundlist=foundlist+[t]
     else:
         foundlist=tickers
     
+    """
     if len(foundlist) > 0:
         foundlist_names=codetranslate(foundlist)
         print("Results:",itemk,"info found for the stocks below")
         printInLine(foundlist_names,numberPerLine=numberPerLine,leadingBlanks=2)
         printInLine(foundlist,numberPerLine=numberPerLine,leadingBlanks=2)
-    
+    """
     if (len(notfoundlist) > 0):
         print("Warning:",itemk,"info not found for the stocks below")
         notfoundlist_names=codetranslate(notfoundlist)
         printInLine(notfoundlist_names,numberPerLine=numberPerLine,leadingBlanks=2)
     
     return df
```

## siat/financials_china.py

```diff
@@ -45,15 +45,15 @@
 import pandas as pd
 import akshare as ak
 
 STOCK_SUFFIX_CHINA=['SS','SZ','BJ','NQ']
 #==============================================================================
 #==============================================================================
 if __name__=='__main__':
-    ticker="000002.SZ"
+    ticker="603589.SS"
     ticker='002415.SZ'
     akfs=get_fin_stmt_ak(ticker)
     
 def get_fin_stmt_ak(ticker):
     """
     从akshare获取财务报表数据，合成df，限于中国A股
     获取的项目：所有原始项目
@@ -159,15 +159,21 @@
         except:
             pass
     
     fs3['ticker']=ticker
     fs3['endDate']=fs3.index.strftime('%Y-%m-%d')
     
     # 删除重复的列
+    fs3t=fs3.T
+    fs3t['check']=fs3t.index  #给每行增加不同，防止drop_duplicates误删除
+    fs3td=fs3t.drop_duplicates(keep='first')
+    fs4=fs3td.T
+    """
     fs4=fs3.T.drop_duplicates(keep='first').T
+    """
     
     return fs4
 
 """
 ['流动资产', '货币资金', '交易性金融资产', '衍生金融资产', '应收票据及应收账款',
  '应收票据', '应收账款', '应收款项融资', '预付款项', '其他应收款(合计)', '应收利息',
  '应收股利', '其他应收款', '买入返售金融资产', '存货', '划分为持有待售的资产',
@@ -191,48 +197,48 @@
  '非流动负债合计',
  '负债合计',
  '所有者权益', '实收资本(或股本)', '资本公积', '减：库存股', '其他综合收益',
  '专项储备', '盈余公积', '一般风险准备', '未分配利润', '归属于母公司股东权益合计',
  '所有者权益(或股东权益)合计',
  '负债和所有者权益(或股东权益)总计',
  
- '一、营业总收入', '营业收入',
- '二、营业总成本', '营业成本', '营业税金及附加', '销售费用', '管理费用', '研发费用',
+ '营业总收入', '营业收入',
+ '营业总成本', '营业成本', '营业税金及附加', '销售费用', '管理费用', '研发费用',
  '资产减值损失', '公允价值变动收益', '投资收益', '其中:对联营企业和合营企业的投资收益',
  '汇兑收益',
- '三、营业利润', '加:营业外收入', '减：营业外支出', '其中：非流动资产处置损失',
+ '营业利润', '加:营业外收入', '减：营业外支出', '其中：非流动资产处置损失',
  '四、利润总额', '减：所得税费用',
- '五、净利润', '归属于母公司所有者的净利润', '少数股东损益',
- '六、每股收益', '基本每股收益(元/股)', '稀释每股收益(元/股)',
- '七、其他综合收益',
- '八、综合收益总额', '归属于母公司所有者的综合收益总额', '归属于少数股东的综合收益总额',
+ '净利润', '归属于母公司所有者的净利润', '少数股东损益',
+ '每股收益', '基本每股收益(元/股)', '稀释每股收益(元/股)',
+ '其他综合收益',
+ '综合收益总额', '归属于母公司所有者的综合收益总额', '归属于少数股东的综合收益总额',
  '报表日期', '单位',
  
- '一、经营活动产生的现金流量', '销售商品、提供劳务收到的现金', '收到的税费返还',
+ '经营活动产生的现金流量', '销售商品、提供劳务收到的现金', '收到的税费返还',
  '收到的其他与经营活动有关的现金', '经营活动现金流入小计', '购买商品、接受劳务支付的现金',
  '支付给职工以及为职工支付的现金', '支付的各项税费', '支付的其他与经营活动有关的现金',
  '经营活动现金流出小计', '经营活动产生的现金流量净额',
- '二、投资活动产生的现金流量', '收回投资所收到的现金', '取得投资收益所收到的现金',
+ '投资活动产生的现金流量', '收回投资所收到的现金', '取得投资收益所收到的现金',
  '处置固定资产、无形资产和其他长期资产所收回的现金净额',
  '处置子公司及其他营业单位收到的现金净额', '收到的其他与投资活动有关的现金',
  '投资活动现金流入小计',
  '购建固定资产、无形资产和其他长期资产所支付的现金', '投资所支付的现金',
  '取得子公司及其他营业单位支付的现金净额', '支付的其他与投资活动有关的现金',
  '投资活动现金流出小计',
  '投资活动产生的现金流量净额',
- '三、筹资活动产生的现金流量', '吸收投资收到的现金', '其中：子公司吸收少数股东投资收到的现金',
+ '筹资活动产生的现金流量', '吸收投资收到的现金', '其中：子公司吸收少数股东投资收到的现金',
  '取得借款收到的现金', '发行债券收到的现金', '收到其他与筹资活动有关的现金',
  '筹资活动现金流入小计',
  '偿还债务支付的现金', '分配股利、利润或偿付利息所支付的现金',
  '其中：子公司支付给少数股东的股利、利润', '支付其他与筹资活动有关的现金',
  '筹资活动现金流出小计',
  '筹资活动产生的现金流量净额',
- '四、汇率变动对现金及现金等价物的影响',
- '五、现金及现金等价物净增加额', '加:期初现金及现金等价物余额',
- '六、期末现金及现金等价物余额',
+ '汇率变动对现金及现金等价物的影响',
+ '现金及现金等价物净增加额', '加:期初现金及现金等价物余额',
+ '期末现金及现金等价物余额',
  
  '附注',
  '净利润',
  '未确认的投资损失', '资产减值准备',
  '固定资产折旧、油气资产折耗、生产性物资折旧', '无形资产摊销', '长期待摊费用摊销',
  '待摊费用的减少', '预提费用的增加', '处置固定资产、无形资产和其他长期资产的损失',
  '固定资产报废损失', '公允价值变动损失', '递延收益增加（减：减少）', '预计负债',
@@ -364,43 +370,54 @@
     
     return alr_info,group_df
     
 if __name__=='__main__':
     liability_rank_china(endDate='2020-12-31')
 #==============================================================================
 if __name__=='__main__':
-    ticker='600519.SS'
+    ticker='603589.SS'
     start='2018-1-1'
-    end='2021-11-24'
+    end='2022-12-31'
     period_type='all'
 
 def calc_dupont_china(ticker,start,end,period_type='all'):
     """
     功能：计算股票ticker的杜邦分析项目，基于财报期末数直接计算，仅限于中国A股
     """
     fsr2=get_fin_stmt_ak(ticker)
     if fsr2 is None:
         print("  #Error(calc_dupont_china): failed to retrieved reports for",ticker)
         return None   
     
     fsr3=fsr2[(fsr2['endDate'] >= start) & (fsr2['endDate'] <= end)]
     
     #字段变换与计算
+    #oelist=['所有者权益(或股东权益)合计','所有者权益合计','归属于母公司股东权益合计']
+    oelist=['所有者权益(或股东权益)合计','所有者权益合计']
+    for oe in oelist:
+        try:
+            fsr3['ROE']=fsr3['净利润']/fsr3[oe]
+            break
+        except:
+            continue
+    """    
     try:
         oe='所有者权益(或股东权益)合计'
-        fsr3['ROE']=fsr3['五、净利润']/fsr3[oe]
+        fsr3['ROE']=fsr3['净利润']/fsr3[oe]
     except:
         oe='所有者权益合计'
-        fsr3['ROE']=fsr3['五、净利润']/fsr3[oe]
+        fsr3['ROE']=fsr3['净利润']/fsr3[oe]
+    """    
+        
     try:    
-        tor='一、营业总收入'
-        fsr3['Profit Margin']=fsr3['五、净利润']/fsr3[tor]
+        tor='营业总收入'
+        fsr3['Profit Margin']=fsr3['净利润']/fsr3[tor]
     except:
-        tor='一、营业收入'
-        fsr3['Profit Margin']=fsr3['五、净利润']/fsr3[tor]
+        tor='营业收入'
+        fsr3['Profit Margin']=fsr3['净利润']/fsr3[tor]
     fsr3['Total Assets Turnover']=fsr3[tor]/fsr3['资产总计']
     fsr3['Equity Multiplier']=fsr3['资产总计']/fsr3[oe]
     
     dpidf=fsr3[['ticker','endDate','ROE','Profit Margin','Total Assets Turnover','Equity Multiplier']]    
     dpidf['pROE']=dpidf['Profit Margin']*dpidf['Total Assets Turnover']*dpidf['Equity Multiplier']
     
     return dpidf
@@ -463,16 +480,16 @@
 if __name__=='__main__':
     df1=calc_dupont_china('600519.SS','2018-1-1','2021-12-31')
     df2=calc_dupont_china('600519.SS','2018-1-1','2021-12-31',period_type='annual')
 
 
 #==============================================================================
 if __name__=='__main__':
-    tickerlist=['600606.SS','600519.SS','000002.SZ']
-    fsdate='latest'
+    tickerlist=['603589.SS','600519.SS','000002.SZ']
+    fsdate='2022-12-31'
     scale1 = 10
     scale2 = 10
     hatchlist=['.', 'o', '\\']
 
 def compare_dupont_china(tickerlist,fsdate='latest',scale1 = 10,scale2 = 10, \
                          hatchlist=['.', 'o', '\\'],printout=True,sort='PM'):
     """
@@ -2633,37 +2650,37 @@
     pm='销售净利率'
     tat='总资产周转率'
     
     debtRatio='资产负债率'
     totalLiabValue=round(fs1['负债合计'].values[0] / yi,1)
     
     netProfit='净利润'
-    netProfitValue=round(fs1['五、净利润'].values[0] / yi,1)
+    netProfitValue=round(fs1['净利润'].values[0] / yi,1)
     roePct=round(netProfitValue / totalOEValue *100,2)
     
     sales='销售收入'
     try:
-        salesValue=round(fs1['一、营业总收入'].values[0] / yi,1)
+        salesValue=round(fs1['营业总收入'].values[0] / yi,1)
     except:
-        salesValue=round(fs1['一、营业收入'].values[0] / yi,1)
+        salesValue=round(fs1['营业收入'].values[0] / yi,1)
         
     pmPct=round(netProfitValue / salesValue *100,2)
     
     totalAssets='资产总额'
     totalAssetsValue=round(fs1['资产总计'].values[0] / yi,1)
     tatValue=round(salesValue / totalAssetsValue *100,2)
     emValue=round(totalAssetsValue / totalOEValue,2)
     debtRatioPct=round(totalLiabValue / totalAssetsValue *100,2)
     roaPct=round(netProfitValue / totalAssetsValue *100,2)
     
     totalCosts='成本费用'
     try:
-        totalCostsValue=round(fs1['二、营业总成本'].values[0] / yi,1)
+        totalCostsValue=round(fs1['营业总成本'].values[0] / yi,1)
     except:
-        totalCostsValue=round(fs1['二、营业支出'].values[0] / yi,1)
+        totalCostsValue=round(fs1['营业支出'].values[0] / yi,1)
     
     currentAssets='流动资产'
     try:
         currentAssetsValue=round(fs1['流动资产合计'].values[0] / yi,1)
     except:
         try:
             currentAssetsValue=round((fs1['现金及存放中央银行款项'].values[0] \
@@ -2725,15 +2742,15 @@
                                + fs1['其他资产'].values[0] \
                                     )/ yi,1)
             
     salesCosts='营业\\n成本'
     try:
         salesCostsValue=round(fs1['营业成本'].values[0] / yi,1)
     except:
-        salesCostsValue=round(fs1['二、营业支出'].values[0] / yi,1)
+        salesCostsValue=round(fs1['营业支出'].values[0] / yi,1)
     
     periodExpenses='期间\\n费用'
     salesExpenses='销售\\n费用'
     try:
         salesExpensesValue=round(fs1['销售费用'].values[0] / yi,1)
     except:
         salesExpensesValue=0.0
```

## siat/risk_adjusted_return.py

```diff
@@ -464,15 +464,15 @@
     #rars2=rars1.interpolate(method='pchip')
     #rars2=rars1.interpolate(method='akima')
     rars2=rars1.interpolate(method='cubic')
     """
         
     #plt.figure(figsize=(8,5))
  
-    labeltxt=ratio_name.capitalize()+'指数'    
+    labeltxt=ratio_name.capitalize()+'指标'    
     plt.plot(rars['RAR'],label=labeltxt,color='red',lw=1)
     #plt.plot(rars['Mean(Ret)'],label='Stock(s) return(%)',color='blue',lw=1)
     plt.axhline(y=0.0,color='black',linestyle=':')
     
     titletxt='风险调整收益的滚动趋势'+'\n'+str(codetranslate(stocklist))
     if len(stocklist) > 1:
         titletxt=titletxt+'\n持仓比例: '+str(portionlist)
```

## siat/sector_china.py

```diff
@@ -41,18 +41,23 @@
         print("#Error(sector_list_china): unsupported sectoring method",indicator)
         print("Supported sectoring methods:",indicatorlist)
         return None
     
     import akshare as ak
     try:
         df = ak.stock_sector_spot(indicator=indicator)
+        
+        #去掉空格，否则匹配容易失败
+        df['板块']=df['板块'].apply(lambda x: x.strip())   
+        df['label']=df['label'].apply(lambda x: x.strip())
+        
     except:
-        print("#Error(sector_list_china): data source tentatively unavailable for",indicator)
-        print("Possible reason: data source is self-updating.")
-        print("Solution: have a breath of fresh air and try later.")
+        print("  #Error(sector_list_china): data source tentatively unavailable for",indicator)
+        print("  Possible reason: data source is self-updating.")
+        print("  Solution: have a breath of fresh air and try later.")
         return None
     
     sectorlist=list(df['板块'])
     #按照拼音排序
     sectorlist=list(set(list(sectorlist)))
     sectorlist=sort_pinyin(sectorlist)
     #解决拼音相同带来的bug：陕西省 vs 山西省
@@ -115,44 +120,55 @@
 
 #==============================================================================
 if __name__=='__main__':
     sector_name="房地产"
     indicator="启明星行业"
     indicator="地域"
     indicator="行业"
+    
+    sector_name="煤炭"
+    sector_code_china(sector_name)
 
 def sector_code_china(sector_name):
     """
     功能：查找行业、板块名称对应的板块代码
     """
     import akshare as ak
     print("\n===== 查询行业/板块代码 =====")
     
     indicatorlist=["新浪行业","概念","地域","启明星行业","行业"]
     sector_code=''; found=0
     for i in indicatorlist:
         dfi=ak.stock_sector_spot(indicator=i)
+        
+        #去掉空格，否则匹配容易失败
+        dfi['板块']=dfi['板块'].apply(lambda x: x.strip())  
+        dfi['label']=dfi['label'].apply(lambda x: x.strip())
+        
         try:
             sector_code=list(dfi[dfi['板块']==sector_name]['label'])[0]
             #记录找到的板块分类
             indicator=i
             #记录找到的板块概述
             dff=dfi[dfi['板块']==sector_name]
             
             if found > 0: print(" ")
             if indicator == "行业": indicator = "证监会行业"
             print("行业/板块名称："+sector_name)
             print("行业/板块代码："+sector_code,end='')
             print(", "+indicator+"分类")
             found=found+1
         except:
+            # 无意义，仅为调试
+            x=1
             continue
+    
     #未找到板块代码
-    if sector_name == '':
-        print("#Error(sector_code_china): unsupported sector name",sector_name)
+    if found==0:
+        print("  #Error(sector_code_china): unsupported sector name",sector_name)
         return 
     
     return 
 
 if __name__=='__main__':
     sector_name="房地产"
     df=sector_code_china(sector_name)
@@ -194,14 +210,19 @@
         print("#Error(sector_list_china): unsupported sectoring method",indicator)
         print("Supported sectoring method:",indicatorlist)
         return None
     
     import akshare as ak
     try:
         df = ak.stock_sector_spot(indicator=indicator)  
+        
+        #去掉空格，否则匹配容易失败
+        df['板块']=df['板块'].apply(lambda x: x.strip())   
+        df['label']=df['label'].apply(lambda x: x.strip())
+        
     except:
         print("#Error(sector_rank_china): data source tentatively unavailable for",indicator)
         print("Possible reason: data source is self-updating.")
         print("Solution: have a breath of fresh air and try later.")
         return None
     
     df.dropna(inplace=True)
@@ -270,14 +291,15 @@
     #处理空记录
     if len(df3) == 0:
         print("#Error(sector_rank_china):data source tentatively unavailable for",comp,indicator)
         print("Possible reason: data source is self-updating.")
         print("Solution: have a breath of fresh air and try later.")
         return
     
+    df3.index=df3.index + 1
     print("\n===== 中国股票市场：板块"+comp+"排行榜（按照"+indtag+"分类） =====")
     if num > 0:
         print(df3.head(num))
     else:
         print(df3.tail(-num))
     
     import datetime
@@ -312,14 +334,19 @@
     
     #检查板块代码是否存在
     import akshare as ak
     indicatorlist=["新浪行业","概念","地域","启明星行业","行业"]
     sector_name=''
     for i in indicatorlist:
         dfi=ak.stock_sector_spot(indicator=i)
+        
+        #去掉字符串中的空格，否则匹配容易失败
+        dfi['板块']=dfi['板块'].apply(lambda x: x.strip()) 
+        dfi['label']=dfi['label'].apply(lambda x: x.strip())
+        
         if debug: print("i=",i)
         try:
             sector_name=list(dfi[dfi['label']==sector]['板块'])[0]
             #记录找到的板块分类
             indicator=i
             #记录找到的板块概述
             dff=dfi[dfi['label']==sector]
@@ -394,14 +421,15 @@
     import pandas as pd
     pd.set_option('display.max_columns', 1000)
     pd.set_option('display.width', 1000)
     pd.set_option('display.max_colwidth', 1000)
     pd.set_option('display.unicode.ambiguous_as_wide', True)
     pd.set_option('display.unicode.east_asian_width', True)
     
+    df3.index=df3.index + 1
     print("\n=== 中国股票市场："+sector_name+"板块，成份股排行榜（按照"+comp+"） ===")
     if num > 0:
         print(df3.head(num))
     else:
         print(df3.tail(-num))
     
     import datetime
@@ -410,75 +438,81 @@
     print(footnote1+"板块内成份股个数:",len(df))
     print(" 数据来源：新浪财经,",today,"\b（信息为上个交易日）") 
 
     return df2
 
 #==============================================================================
 if __name__=='__main__':
-    ticker='600021'
-    ticker='000661'
-    ticker='999999'
+    ticker='600021.SS'
+    ticker='000661.SZ'
+    ticker='999999.SS'
     sector="new_dlhy"
     sector="yysw"
     sector="xyz"
 
 def sector_position_china(ticker,sector="new_dlhy"):
     """
     功能：查找一只股票在板块内的百分数位置
     ticker：股票代码
     sector：板块代码
     """
+    ticker1=ticker[:6]
     
     import akshare as ak
     import numpy as np
     import pandas as pd    
     
     #检查板块代码是否存在
     indicatorlist=["新浪行业","概念","地域","启明星行业","行业"]
     sector_name=''
     for i in indicatorlist:
         dfi=ak.stock_sector_spot(indicator=i)
+        
+        #去掉空格，否则匹配容易失败
+        dfi['板块']=dfi['板块'].apply(lambda x: x.strip())   
+        dfi['label']=dfi['label'].apply(lambda x: x.strip())
+        
         try:
             sector_name=list(dfi[dfi['label']==sector]['板块'])[0]
             #记录找到的板块分类
             indicator=i
             #记录找到的板块概述
             dff=dfi[dfi['label']==sector]
             break
         except:
             continue
     #未找到板块代码
     if sector_name == '':
-        print("#Error(sector_position_china): unsupported sector code",sector)
+        print("  #Error(sector_position_china): unsupported sector code",sector)
         return None
     
     #板块成份股
     try:
         #启明星行业分类没有成份股明细
         df = ak.stock_sector_detail(sector=sector)
     except:
-        print("#Error(sector_position_china): sector detail not available for",sector,'by',indicator)
-        print("Possible reason: data source is self-updating.")
-        print("Solution: have a breath of fresh air and try later.")
+        print("  #Error(sector_position_china): sector detail not available for",sector,'by',indicator)
+        print("  Possible reason: data source is self-updating.")
+        print("  Solution: have a breath of fresh air and try later.")
         return None
 
     #清洗原始数据: #可能同时含有数值和字符串，强制转换成数值
     df['changepercent']=round(df['changepercent'].astype('float'),2)
     df['turnoverratio']=round(df['turnoverratio'].astype('float'),2)
     df['settlement']=round(df['settlement'].astype('float'),2)
     df['per']=round(df['per'].astype('float'),2)
     df['pb']=round(df['pb'].astype('float'),2)
     df['nmc']=round(df['nmc'].astype('int')/10000,2)
     df['mktcap']=round(df['mktcap'].astype('int')/10000,2)
     
     #检查股票代码是否存在
-    sdf=df[df['code']==ticker]
+    sdf=df[df['code']==ticker1]
     if len(sdf) == 0:
-        print("#Error(sector_position_china): retrieving",ticker,"failed in sector",sector,sector_name)
-        print("#Try later if network responses slowly.")
+        print("  #Error(sector_position_china): retrieving",ticker,"failed in sector",sector,sector_name)
+        print("  Try later if network responses slowly.")
         return None       
     sname=list(sdf['name'])[0]
     
     #确定比较范围
     complist=['changepercent','turnoverratio','settlement','per','pb','nmc','mktcap']
     compnames=['涨跌幅%','换手率%','收盘价(元)','市盈率','市净率','流通市值(亿元)','总市值(亿元)']
     compdf=pd.DataFrame(columns=['指标名称','指标数值','板块百分位数%','板块中位数','板块最小值','板块最大值'])
@@ -511,15 +545,16 @@
     pd.set_option('display.unicode.ambiguous_as_wide', True)
     pd.set_option('display.unicode.east_asian_width', True)
     
     print(compdf.to_string(index=False))
     
     import datetime
     today = datetime.date.today()
-    print("*板块内成份股个数:",len(df),"\b, 数据来源：新浪财经,",today,"\b（信息为上个交易日）")
+    print('') #空一行
+    print("注：板块内成份股个数:",len(df),"\b, 数据来源：新浪财经,",today,"\b(信息为上个交易日)")
 
     return df,compdf    
     
 
 #==============================================================================
 
 def invest_concept_china(num=10):
@@ -530,14 +565,19 @@
     """
     print("\nWarning: This function might cause your IP address banned by data source!")
     print("Searching stocks with investment concepts in China, it may take long time ...")
     
     #找出投资概念列表
     import akshare as ak
     cdf = ak.stock_sector_spot(indicator="概念")
+    
+    #去掉空格，否则匹配容易失败
+    cdf['板块']=cdf['板块'].apply(lambda x: x.strip())
+    cdf['label']=cdf['label'].apply(lambda x: x.strip())    
+    
     cdf.sort_values(by=['label'],ascending=True,inplace=True)
     clist=list(cdf['label'])
     cnames=list(cdf['板块'])
     cnum=len(clist)
     
     import pandas as pd
     totaldf=pd.DataFrame()
```

## siat/stock.py

```diff
@@ -1440,14 +1440,17 @@
                         scalingOptionText='起点值'
                     
                 meanlist=meanlist+[cmean]
             
             #print(cmean,cstd,dfs2[c])
 
         if preprocess1 == 'scaling':
+            if len(meanlist)==0:
+                return None
+            
             meanlistmin=min(meanlist)
             meanlist2= [x / meanlistmin for x in meanlist]
             for c in collist:
                 pos=collist.index(c)
                 cfactor=meanlist2[pos]
                 dfs2[c]=dfs2[c].apply(lambda x: x/cfactor)
```

## Comparing `siat-2.0.7.dist-info/METADATA` & `siat-2.0.8.dist-info/METADATA`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: siat
-Version: 2.0.7
+Version: 2.0.8
 Summary: Securities Investment Analysis Tools (siat)
 Home-page: https://pypi.org/project/siat/
 Author: Prof. WANG Dehong, Business School, BFSU (北京外国语大学 国际商学院 王德宏 教授)
 Author-email: wdehong2000@163.com
 License: Copyright (C) WANG Dehong, 2023. For educational purpose only!
 Platform: UNKNOWN
 Requires-Dist: pandas-datareader
```

## Comparing `siat-2.0.7.dist-info/RECORD` & `siat-2.0.8.dist-info/RECORD`

 * *Files 2% similar despite different names*

```diff
@@ -30,16 +30,16 @@
 siat/esg.py,sha256=Kzui78HKwnLvtxWcjjnSjME6IZKK9cR3zSZYqTtAO0k,18941
 siat/esg_test.py,sha256=Z9m6GUt8O7oHZSEG9aDYpGdvvrv2AiRJdHTiU6jqmZ0,2944
 siat/fama_french.py,sha256=qDpsZOj0BLuzXXdNwJ1IPhDyNVAnTJFHqn80Hkp85ZI,47177
 siat/fama_french_test.py,sha256=M4O23lBKsJxhWHRluwCb3l7HSEn3OFTjzGMpehcevRg,4678
 siat/financial_base.py,sha256=YxNVfhbgLQ4stLojI9nklB4sdQNuROcILcO3M2uz4Gs,40695
 siat/financial_statements.py,sha256=KDUl9b92EV5IseLLnEmG3czDHAaay2SWM2MpzZXPHpk,21528
 siat/financial_statements_test.py,sha256=FLhx8JD-tVVWSBGux6AMz1jioXX4U4bp9DmgFHYXb_w,716
-siat/financials.py,sha256=4b0fJAu1Mm5aX_zCIvF01CzzBokrprQpIk1N3za1FNA,76676
-siat/financials_china.py,sha256=ZmwO9x6Gd_b1XM_dNy2AYLhhLumjlLGfCIBfNIu8kSs,173542
+siat/financials.py,sha256=Q83byemMjO8PqKp6MF196BV4NWLu5uwJU7cqZvKyoyk,77162
+siat/financials_china.py,sha256=eE7Gi678zRuqEEKoKygPbS3PFvD5HdNDJYTJzyZ3mG8,173961
 siat/financials_china2.py,sha256=NKYsPOp36qGBT0qt7TwlRIcu-FE8CoKifYWjTwDHgaw,60037
 siat/financials_china2_test.py,sha256=Erz5k4LyOplBBvYls2MypuqHpVNJ3daiLdyeJezNPu0,2722
 siat/financials_china2_test2.py,sha256=C8CuYTMHN4Mhp-sTu-Bmg0zMXRCaYV6ezGDoYartRYQ,3507
 siat/financials_china2_test3.py,sha256=UXYSA80DNSPRhHpovc2MA9JkpILWMAQaRatbWCHBNPs,3118
 siat/financials_china_test.py,sha256=QS1SD_mXx4uH1Lg3gl2PmwLrvkLqkRs3e4x7SyFI_Xk,17549
 siat/financials_china_test2.py,sha256=WkNlVW_0hGegdw1rzg4BP_dKR-smdyUp9Fr00K7mPZY,5924
 siat/financials_china_test2_fin_indicator.py,sha256=WkNlVW_0hGegdw1rzg4BP_dKR-smdyUp9Fr00K7mPZY,5924
@@ -69,28 +69,28 @@
 siat/option_china.py,sha256=Oorj8Bmrl22kuLOkEiqnTPwe37Jw-Vo3AhICQX4uwEc,95158
 siat/option_china_test.py,sha256=UQ-YUHUjoGBQyanLcM-yzqeEIUQP_gCQIeT0W6rnUnA,16355
 siat/option_pricing.py,sha256=ZvOziCkXODUjqSw2Q7Ux_gepw9UQaGMgvbI_YuceyX8,69625
 siat/option_pricing_test.py,sha256=eeorV5Ja5vjlRXnP6fWJHetGU5Vb8SnLopkC6RV3GfA,2203
 siat/option_sina_api_test.py,sha256=dn-k_wrQnAaNKHoROvWJEc7lqlU0bwiV2Aa4usWAFGM,5908
 siat/proxy_test.py,sha256=erQJrmGs2X46z8Gb1h-7GYQ0rTUcaR8dxHExWoBz2eM,2610
 siat/quandl_test.py,sha256=EcPoXnLuqzPl5dKyVEZi3j3PJZFpsnU_iNPhLWC9p-A,1552
-siat/risk_adjusted_return.py,sha256=8vyjOCap9xEvWIpJnBEsDm8Ba3CD9QrEXy2qFG6zvVk,49073
+siat/risk_adjusted_return.py,sha256=24eQIjOdOuRp5yl_DH9WCuk_R5M7mlJj0uTVcKw1SuE,49073
 siat/risk_adjusted_return_test.py,sha256=m_VHL5AtT74cJv5i7taTeTfnkX48y0AFJk5phawyYWg,3416
 siat/risk_evaluation.py,sha256=lCDqCaSEppH0MFPFg-P14IYcF3IJqILbPfDmzf_AfcY,75061
 siat/risk_evaluation_test.py,sha256=YEXM96gKzTfwN4U61AS4Rr1tV7KgUvn4rRC6f3iMw9s,3731
 siat/risk_free_rate.py,sha256=r62zCl1qbI4lJU17GsgM-OmVx9oo3dltXeZVCNd6Uxg,12304
 siat/risk_free_rate_test.py,sha256=CpmhUf8aEAEZeNu4gvWP2Mz2dLoIgBX5bI41vfUBEr8,4285
-siat/sector_china.py,sha256=0JFs5wXZXOu5tuGnFXKBuR4TVIGqvP_W4psQAAAjW-M,100084
+siat/sector_china.py,sha256=sHd7nlYWCK0SWAZbu-BLn-3vNPe2E8OFaDFYF67Hoho,101523
 siat/sector_china_test.py,sha256=1wq7ef8Bb_L8F0h0W6FvyBrIcBTEbrTV7hljtpj49U4,5843
 siat/security_price.py,sha256=2oHskgiw41KMGfqtnA0i2YjNNV6cYgtlUK0j3YeuXWs,29185
 siat/security_prices.py,sha256=vmN39llWbm-B1awfuZzR14UlEca6Tm3KOvBQUYZJzXw,71984
 siat/security_prices_test.py,sha256=OEphoJ87NPKoNow1QA8EU_5MUYrJF-qKoWKNapVfZNI,10779
 siat/setup.py,sha256=up65rQGLmTBkhtaMLowjoQXYmIsnycnm4g1SYmeQS6o,1335
 siat/shenwan index history test.py,sha256=JCVAzOSEldHalhSFa3pqD8JI_8_djPMQOxpkuYU-Esg,1418
-siat/stock.py,sha256=zIDSttJSO6z5Cp4Jq5eNeRHvmeqCkhMZgwIM_aGT47s,117962
+siat/stock.py,sha256=unwmbNTT5vC3v9cg4XtnpPBawPVxtBTgRnevE1i0T00,118039
 siat/stock_advice_linear.py,sha256=-twT7IGP-NEplkL1WPSACcNJjggRB2j4mlAQCkzOAuo,31655
 siat/stock_base.py,sha256=uISvbRyOGy8p9QREA96CVydgflBkn5L3OXOGKl8oanc,1312
 siat/stock_china.py,sha256=qsrGq5tUyToOGDfVRnMEeiGps2Tpz5o38LlK6kB6k3Y,68123
 siat/stock_china_test.py,sha256=Qc1m19FAUSvBi9E0ZTVcYBveiGYFIlIFvthbidzCe1s,1276
 siat/stock_info.pickle,sha256=gzhzPvCrX3tr24CzWPVAOXPJ21XQ5keU2cz6PfKwfJ8,1242926
 siat/stock_info_test.py,sha256=gfG3DbhDACbtD8wnv_R6zhj0t11XaC8NX8uLD9Qv3Fo,6122
 siat/stock_list_china_test.py,sha256=gv14UwMMvkZqtb6G7DCTSuehIwVHuVwu7w60p6gyHoo,1014
@@ -108,11 +108,11 @@
 siat/translate-20230206.py,sha256=-vtI125WyaJhmPotOpDAmclt_XnYVaWU9ByLWZ6FyYE,118133
 siat/translate-20230215.py,sha256=TJgtPE3n8IjljmZ4Pefy8dmHoNdFF-1zpML6BhA9FKE,121657
 siat/translate.py,sha256=pW6jWGfuypUNgZiu_ojJLsaEOEb12XWDzdp77z1sG3I,126254
 siat/universal_test.py,sha256=CDAOffW1Rvs-TcNN5giWVvHMlch1w4dp-w5SIV9jXL0,3936
 siat/valuation_china.py,sha256=gYYXeT9bBPyQ251TCsYlibWcu6JA8x-YOKqLUEeLE7U,51342
 siat/valuation_market_china_test.py,sha256=gbJ0ioauuo4koTPH6WKUkqcXiQPafnbhU5eKJ6lpdLA,1571
 siat/var_model_validation.py,sha256=zB_Skk_tmzIR15l6oAW3am4HBGVIG-eZ8gJhCdXZ8Qw,14859
-siat-2.0.7.dist-info/METADATA,sha256=0EqJR3k60Tub6vJw9HCaWO-7bjd5cI1_YFk7UEUD308,1399
-siat-2.0.7.dist-info/WHEEL,sha256=ewwEueio1C2XeHTvT17n8dZUJgOvyCWCt0WVNLClP9o,92
-siat-2.0.7.dist-info/top_level.txt,sha256=r1cVyL7AIKqeAmEJjNR8FMT20OmEzufDstC2gv3NvEY,5
-siat-2.0.7.dist-info/RECORD,,
+siat-2.0.8.dist-info/METADATA,sha256=mDOyGH3sWynimC6vhxnpiD4daBL_EvEwnMsEFVFWw2g,1399
+siat-2.0.8.dist-info/WHEEL,sha256=ewwEueio1C2XeHTvT17n8dZUJgOvyCWCt0WVNLClP9o,92
+siat-2.0.8.dist-info/top_level.txt,sha256=r1cVyL7AIKqeAmEJjNR8FMT20OmEzufDstC2gv3NvEY,5
+siat-2.0.8.dist-info/RECORD,,
```

